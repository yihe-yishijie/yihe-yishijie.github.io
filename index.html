<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  
  <title>弈世界 | 认知世界、连通万物</title>

  
  <meta name="author" content="弈何">
  

  

  
  <meta name="keywords" content="笔记">
  

  <meta id="viewport" name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, minimum-scale=1, user-scalable=no, minimal-ui">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black">

  

  <meta property="og:site_name" content="弈世界"/>

  
  <meta property="og:image" content="/favicon.ico"/>
  

  <link href="/favicon.ico" rel="icon">
  <link rel="alternate" href="/atom.xml" title="弈世界" type="application/atom+xml">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">
<meta name="generator" content="Hexo 5.3.0"></head>


<body>
<div class="blog">
  <div class="content">

    <header>
  <div class="site-branding">
    <h1 class="site-title">
      <a href="/">弈世界</a>
    </h1>
    <p class="site-description">认知世界、连通万物</p>
  </div>
  <nav class="site-navigation">
    <ul>
      
        <li><a href="/">主页</a></li>
      
        <li><a href="/archives">归档</a></li>
      
        <li><a href="/categories">分类</a></li>
      
        <li><a href="/tags">标签</a></li>
      
    </ul>
  </nav>
</header>

    <main class="site-main posts-loop">
    
  <article>

  
    
    <h3 class="article-title"><a href="/2021/01/27/新冠肺炎病毒/"><span>新冠肺炎病毒</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2021/01/27/新冠肺炎病毒/" rel="bookmark">
        <time class="entry-date published" datetime="2021-01-27T02:54:17.000Z">
          2021-01-27
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><strong>关键词：<font color="#BF360C">2019新型冠状病毒</font></strong></p>
<hr>
<p><strong>简介</strong><br>回顾并展望2019新型冠状病毒</p>
        
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/2019新型冠状病毒/">2019新型冠状病毒</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/2019新型冠状病毒/">2019新型冠状病毒</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2021/01/07/2020年总结/"><span>2020年总结</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2021/01/07/2020年总结/" rel="bookmark">
        <time class="entry-date published" datetime="2021-01-06T22:06:19.000Z">
          2021-01-07
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><strong>关键词：<font color="#BF360C">新冠肺炎，美国大选，注意力，卡片</font></strong></p>
<hr>
<p><strong>2020年是不平凡的一年，也是百年未有之大变局关键转折的一年。这里总结去年，展望新年，希望新的一年更上一层楼。</strong></p>
        
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/认知自我/">认知自我</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/总结/">总结</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2021/01/02/搭建私有云笔记-技术篇9搭建个人博客/"><span>搭建私有云笔记-技术篇9搭建个人博客</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2021/01/02/搭建私有云笔记-技术篇9搭建个人博客/" rel="bookmark">
        <time class="entry-date published" datetime="2021-01-02T05:42:32.000Z">
          2021-01-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><strong>关键词：<font color="#BF360C">IT、树莓派4b、博客、hexo</font></strong></p>
<hr>
<h2 id="搭建个人博客"><a href="#搭建个人博客" class="headerlink" title="搭建个人博客"></a>搭建个人博客</h2><p>现在比较流行的博客包括wordpress，hexo，因为可以生成静态网页，并且免费在github上部署，hexo可以完美支持markdown功能，相比动态博客，hexo低成本易维护，弈何最后选择了hexo。</p>
<p>缺点：静态博客互动性差</p>
<p>安装环境：<br>硬件，树莓派4b<br>操作系统，Raspbian GNU/Linux 10 (buster)</p>
<hr>
<h4 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h4><p>推荐这篇文章，讲的很详细<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/sinat_37781304/article/details/82729029">hexo史上最全搭建教程_Fangzh的技术博客-CSDN博客_hexo</a></p>
<p>简单记录安装过程</p>
<p>安装Git<br><code>sudo apt-get install git</code></p>
<p>安装nodejs<br><font color="#BF360C"><strong>Nodejs及其Nodejs下的包管理器npm与hexo有版本匹配的问题，建议使用某大神开发的Node版本管理控制器n来安装</strong></font></p>
<p>安装nodejs版本控制器<br><code>sudo npm install -g n</code></p>
<p>安装合适的nodejs版本（需要根据最新的hexo版本选择合适的nodejs和nmp—Node Package Manager,即:node包管理器版本）<br><code>sudo n 12.12.0 alias -g</code></p>
<p>nodejs版本查询网页：<br><a target="_blank" rel="noopener" href="https://nodejs.org/en/download/releases/">Previous Releases | Node.js</a></p>
<p>安装版本查询<br><code>node -v &amp;&amp; npm -v</code></p>
<p>切换到安装文件夹后，安装hexo<br><code>npm install hexo</code><br><code>echo &#39;PATH=&quot;$home/xxxx/hexo:./node_modules/.bin&quot;&#39; &gt;&gt; ~/.profile</code><br>其中<code>$home/xxxx/hexo</code>是你自己的安装路径</p>
<p>安装完成<br>cd到hexo目录中完成博客初始化<br><code>hexo init blog</code><br>blog是博客的具体目录</p>
<p>进入目录<br><code>cd blog</code><br>配置环境<br><code>npm install</code></p>
<hr>
<h4 id="更换主题"><a href="#更换主题" class="headerlink" title="更换主题"></a>更换主题</h4><p>在官网选中喜欢的主题后，在其github仓库中找到主题文件的下载地址，然后用<code>git clone</code>命令在themes目录中添加主题。<br><font color="#BF360C"><strong>多读read me</strong></font></p>
<p>例如<br><code>git clone https://github.com/theme-next/hexo-theme-next.git themes/next</code><br>在博客目录/hexo/blog下的node_modules中删除原主题配置文件<code>landscape</code></p>
<p>删除配置依赖参数，路径：/home/xxxx/hexo/blog/package.json<br><img src="/2021/01/02/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%879%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/%E5%88%A0%E9%99%A4%E7%9B%B8%E5%85%B3%E4%BE%9D%E8%B5%96%E5%8F%82%E6%95%B02020123101.png" alt="[删除相关依赖参数2020123101.png]"><br><font color="#BF360C"><strong>一定注意删除上面的”,”</strong></font></p>
<p>进入到博客目录下/hexo/blog，把_config.yml文件中themes的值修改为你的主题名。<br>themes： （你的主题名称，注意前面有一个空格）<br>修改详细方法等参见官网配置说明</p>
<hr>
<h4 id="加分类和标签"><a href="#加分类和标签" class="headerlink" title="加分类和标签"></a>加分类和标签</h4><p><font color="#BF360C"><strong>请阅读自己主题的read me一般有加分类和标签的方法</strong></font></p>
<p>例如这是我选的hacker的主题开启分类和标签的说明文档：</p>
<blockquote>
<p>启用分类和标签页面<br>分类功能：执行 <code>hexo new page categories</code> ，然后修改生成的 <code>source/categories/index.md</code> ：<br>title: 分类<br>date: 2017-01-30 19:16:17<br>layout: “categories”<br>-–<br>如果你需要关闭该页的评论，可以添加一行 <code>comments: false</code>；<code>title</code> 对应的则是该页的标题。<br>标签功能：同理，执行 <code>hexo new page tags</code> ，然后修改生成的 <code>source/tags/index.md</code> ：<br>title: 标签<br>date: 2017-01-30 19:16:17<br>layout: “tags”<br>-–</p>
</blockquote>
<hr>
<h4 id="修改样式模板"><a href="#修改样式模板" class="headerlink" title="修改样式模板"></a>修改样式模板</h4><p>修改了<code>scaffolds</code>中的<code>post</code>模板即可用<code>hexo n(new) &quot;文章题目&quot;</code>自动生成你想要模板的文章。</p>
<p>这是弈何的文章模板：</p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">---</span><br><span class="line">title: &#123;&#123; title &#125;&#125;</span><br><span class="line">date: &#123;&#123; date &#125;&#125;</span><br><span class="line">categories: </span><br><span class="line">tags: </span><br><span class="line"> - </span><br><span class="line">---</span><br><span class="line">**关键词：&lt;font color=#BF360C&gt;、&lt;/font&gt;**</span><br><span class="line"></span><br><span class="line">---</span><br><span class="line">## </span><br><span class="line"></span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<hr>
<h4 id="hexo加图"><a href="#hexo加图" class="headerlink" title="hexo加图"></a>hexo加图</h4><p>参见此贴：<br><a target="_blank" rel="noopener" href="https://www.jianshu.com/p/f72aaad7b852">HEXO插入图片（详细版） - 简书</a></p>
<p>下文为资料存档，避免网页丢失<br>安装插件<br><code>npm install hexo-asset-image --save</code></p>
<p>修改/hexo/blog的配置文件_config.yml的<br><code>post_asset_folder: true</code><br>打开<br><code>undefined/node_modules/hexo-asset-image/index.js</code>将内容更换为下面的代码</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;use strict&#x27;</span>;</span><br><span class="line">var cheerio = require(<span class="string">&#x27;cheerio&#x27;</span>);</span><br><span class="line"></span><br><span class="line">// http://stackoverflow.com/questions/14480345/how-to-get-the-nth-occurrence-in-a-string</span><br><span class="line"><span class="keyword">function</span> getPosition(str, m, i) &#123;</span><br><span class="line">  <span class="built_in">return</span> str.split(m, i).join(m).length;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">var version = String(hexo.version).split(<span class="string">&#x27;.&#x27;</span>);</span><br><span class="line">hexo.extend.filter.register(<span class="string">&#x27;after_post_render&#x27;</span>, <span class="keyword">function</span>(data)&#123;</span><br><span class="line">  var config = hexo.config;</span><br><span class="line">  <span class="keyword">if</span>(config.post_asset_folder)&#123;</span><br><span class="line">        var link = data.permalink;</span><br><span class="line">    <span class="keyword">if</span>(version.length &gt; 0 &amp;&amp; Number(version[0]) == 3)</span><br><span class="line">       var beginPos = getPosition(link, <span class="string">&#x27;/&#x27;</span>, 1) + 1;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">       var beginPos = getPosition(link, <span class="string">&#x27;/&#x27;</span>, 3) + 1;</span><br><span class="line">    // In hexo 3.1.1, the permalink of <span class="string">&quot;about&quot;</span> page is like <span class="string">&quot;.../about/index.html&quot;</span>.</span><br><span class="line">    var endPos = link.lastIndexOf(<span class="string">&#x27;/&#x27;</span>) + 1;</span><br><span class="line">    link = link.substring(beginPos, endPos);</span><br><span class="line"></span><br><span class="line">    var toprocess = [<span class="string">&#x27;excerpt&#x27;</span>, <span class="string">&#x27;more&#x27;</span>, <span class="string">&#x27;content&#x27;</span>];</span><br><span class="line">    <span class="keyword">for</span>(var i = 0; i &lt; toprocess.length; i++)&#123;</span><br><span class="line">      var key = toprocess[i];</span><br><span class="line"> </span><br><span class="line">      var $ = cheerio.load(data[key], &#123;</span><br><span class="line">        ignoreWhitespace: <span class="literal">false</span>,</span><br><span class="line">        xmlMode: <span class="literal">false</span>,</span><br><span class="line">        lowerCaseTags: <span class="literal">false</span>,</span><br><span class="line">        decodeEntities: <span class="literal">false</span></span><br><span class="line">      &#125;);</span><br><span class="line"></span><br><span class="line">      $(<span class="string">&#x27;img&#x27;</span>).each(<span class="function"><span class="title">function</span></span>()&#123;</span><br><span class="line">        <span class="keyword">if</span> ($(this).attr(<span class="string">&#x27;src&#x27;</span>))&#123;</span><br><span class="line">            // For windows style path, we replace <span class="string">&#x27;\&#x27;</span> to <span class="string">&#x27;/&#x27;</span>.</span><br><span class="line">            var src = $(this).attr(<span class="string">&#x27;src&#x27;</span>).replace(<span class="string">&#x27;\\&#x27;</span>, <span class="string">&#x27;/&#x27;</span>);</span><br><span class="line">            <span class="keyword">if</span>(!/http[s]*.*|\/\/.*/.<span class="built_in">test</span>(src) &amp;&amp;</span><br><span class="line">               !/^\s*\//.<span class="built_in">test</span>(src)) &#123;</span><br><span class="line">              // For <span class="string">&quot;about&quot;</span> page, the first part of <span class="string">&quot;src&quot;</span> can<span class="string">&#x27;t be removed.</span></span><br><span class="line"><span class="string">              // In addition, to support multi-level local directory.</span></span><br><span class="line"><span class="string">              var linkArray = link.split(&#x27;</span>/<span class="string">&#x27;).filter(function(elem)&#123;</span></span><br><span class="line"><span class="string">                return elem != &#x27;</span><span class="string">&#x27;;</span></span><br><span class="line"><span class="string">              &#125;);</span></span><br><span class="line"><span class="string">              var srcArray = src.split(&#x27;</span>/<span class="string">&#x27;).filter(function(elem)&#123;</span></span><br><span class="line"><span class="string">                return elem != &#x27;</span><span class="string">&#x27; &amp;&amp; elem != &#x27;</span>.<span class="string">&#x27;;</span></span><br><span class="line"><span class="string">              &#125;);</span></span><br><span class="line"><span class="string">              if(srcArray.length &gt; 1)</span></span><br><span class="line"><span class="string">                srcArray.shift();</span></span><br><span class="line"><span class="string">              src = srcArray.join(&#x27;</span>/<span class="string">&#x27;);</span></span><br><span class="line"><span class="string">              $(this).attr(&#x27;</span>src<span class="string">&#x27;, config.root + link + src);</span></span><br><span class="line"><span class="string">              console.info&amp;&amp;console.info(&quot;update link as:--&gt;&quot;+config.root + link + src);</span></span><br><span class="line"><span class="string">            &#125;</span></span><br><span class="line"><span class="string">        &#125;else&#123;</span></span><br><span class="line"><span class="string">            console.info&amp;&amp;console.info(&quot;no src attr, skipped...&quot;);</span></span><br><span class="line"><span class="string">            console.info&amp;&amp;console.info($(this));</span></span><br><span class="line"><span class="string">        &#125;</span></span><br><span class="line"><span class="string">      &#125;);</span></span><br><span class="line"><span class="string">      data[key] = $.html();</span></span><br><span class="line"><span class="string">    &#125;</span></span><br><span class="line"><span class="string">  &#125;</span></span><br><span class="line"><span class="string">&#125;);</span></span><br></pre></td></tr></table></figure>
<p>然后就可以在markdown中直接插入图片了<br>插入格式<br><code>![图片名称](图片名称.后缀名)</code><br>图片会放在同名文件夹中。</p>
<hr>
<h4 id="git推送"><a href="#git推送" class="headerlink" title="git推送"></a>git推送</h4><p>GitHub创建个人仓库<br>注册<br>创建一个和你用户名相同的仓库，后面加.github.io<br>生成SSH添加到GitHub</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git config --global user.name &quot;yourname&quot;</span><br><span class="line">git config --global user.email &quot;youremail&quot;</span><br></pre></td></tr></table></figure>
<p><code>ssh-keygen -t rsa -b 4096 -C &quot;youremail&quot;</code><br>在.ssh文件中找到公共秘钥<code>id_rsa.pub</code><br>将其复制到GitHub仓库的设置-密钥中<br><img src="/2021/01/02/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%879%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/github%E5%AF%86%E9%92%A52020123102.png" alt="[github密钥2020123102.png]"></p>
<p>github是外网，弈何测试过在国内联通手机不用wifi不能直接打开，可以再配一个gitee仓库</p>
<p>在gitee配置与github相同</p>
<p>修改：<code>_config.yml</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">deploy:</span><br><span class="line">  type: git</span><br><span class="line">  repo: </span><br><span class="line">        github: git@github.com:用户名&#x2F;用户名.github.io.git</span><br><span class="line">        gitee: git@gitee.com:用户名&#x2F;用户名.git</span><br><span class="line">  branch: master</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>安装deploy-git<br><code>npm install hexo-deployer-git --save</code></p>
<hr>
<h4 id="hexo博客使用"><a href="#hexo博客使用" class="headerlink" title="hexo博客使用"></a>hexo博客使用</h4><p>写文章，cd到blog目录下<br><code>hexo n &quot;文章题目&quot;</code></p>
<p>文章创建后会在/home/xxxx/hexo/blog/source/_posts文件下创建已markdown的空文章</p>
<p>hexo支持markdown格式文章，电脑端可在建立的共享文件夹中用obsidian软件进行markdown的编写。</p>
<p>手机端可用es文件浏览器自带的编辑软件通过连接外网的FTP在线修改文字。</p>
<p>然后就用<code>hexo cl &amp;&amp; hexo g &amp;&amp; hexo s</code>查看</p>
<p>其中<code>hexo s</code>可以加<code>-i &quot;192.168.1.xx&quot;</code>（你希望的内网ip）和<code>-p &quot;xx&quot;</code>（你希望的端口号）两个参数</p>
<p>确认无误后可以发布“一键三连”</p>
<p><code>hexo cl &amp;&amp; hexo g &amp;&amp; hexo d</code></p>
<p>发布</p>
<p>至此一款相对安全的、自有跨平台云笔记、云存储安全文件服务器</p>
<p>如果需要增加自动备份，linux硬盘挂载程序，和一些相应的软件都可以实现同步备份功能。</p>
<p>打完收工！！</p>
<hr>
<p><strong><font color="#BF360C">坑1</font>：安装nodejs，Nodejs及其Nodejs下的包管理器npm与hexo有版本匹配的问题，建议使用某大神开发的Node版本管理控制器n来安装。</strong></p>
<p><strong><font color="#BF360C">坑2</font>：加图。</strong></p>
<p><strong><font color="#BF360C">坑3</font>：加字数统计和点击统计。</strong></p>
<p><strong><font color="#BF360C">坑4</font>：发布时，The key you are authenticating with has been marked as read only私钥验证只有可读权限。解决办法如下：</strong><br><img src="/2021/01/02/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%879%E6%90%AD%E5%BB%BA%E4%B8%AA%E4%BA%BA%E5%8D%9A%E5%AE%A2/%E7%A7%81%E9%92%A5%E9%AA%8C%E8%AF%812020122601.png" alt="[私钥验证2020122601.png]"></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/IT/">IT</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/IT/">IT</a><a href="/tags/hexo/">hexo</a><a href="/tags/树莓派4b/">树莓派4b</a><a href="/tags/博客/">博客</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2021/01/02/搭建私有云笔记-技术篇8Samba局域网共享文件夹服务/"><span>搭建私有云笔记-技术篇8Samba局域网共享文件夹服务</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2021/01/02/搭建私有云笔记-技术篇8Samba局域网共享文件夹服务/" rel="bookmark">
        <time class="entry-date published" datetime="2021-01-02T04:42:32.000Z">
          2021-01-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><strong>关键词：<font color="#BF360C">IT、树莓派4b、samba、局域网共享文件夹</font></strong></p>
<h2 id="samba"><a href="#samba" class="headerlink" title="samba"></a>samba</h2><p>安装环境：<br>硬件，树莓派4b<br>操作系统，Raspbian GNU/Linux 10 (buster)</p>
<p>Samba是在Linux和UNIX系统上实现SMB协议的一个免费软件，由服务器及客户端程序构成。SMB（Server Messages Block，信息服务块）是一种在局域网上共享文件和打印机的一种通信协议，它跨平台，跨系统为局域网内的设备提供文件及打印机等资源的共享服务。</p>
<hr>
<h4 id="安装-samba"><a href="#安装-samba" class="headerlink" title="安装 samba"></a>安装 samba</h4><p><code>sudo apt-get install samba samba-common-bin</code><br>配置 Samba<br><code>sudo nano /etc/samba/smb.conf</code><br>末尾加入</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">[共享文件夹名称]</span><br><span class="line">   comment &#x3D; public storage</span><br><span class="line">   path &#x3D; 共享路径</span><br><span class="line">   valid users &#x3D; 希望共享的本地用户</span><br><span class="line">   read only &#x3D; no</span><br><span class="line">   create mask &#x3D; 希望写入文件权限0770</span><br><span class="line">   directory mask &#x3D; 希望的目录创建权限0770</span><br><span class="line">   guest ok &#x3D; no</span><br><span class="line">   browseable &#x3D; yes</span><br><span class="line">   writable &#x3D; no</span><br><span class="line">   write list &#x3D; 希望共享的本地用户</span><br></pre></td></tr></table></figure>
<p>设置文件权限</p>
<p>添加 Samba用户并设置密码<br><code>sudo smbpasswd -a 用户名</code></p>
<p>重启<br><code>sudo samba restart</code></p>
<hr>
<h4 id="windows10开启局域网共享"><a href="#windows10开启局域网共享" class="headerlink" title="windows10开启局域网共享"></a>windows10开启局域网共享</h4><p>修改注册表：<br>[HKEY_LOCAL_MACHINE\SYSTEM\CurrentControlSet\Services\LanmanWorkstation\Parameters]项，在右侧空白处右击鼠标，从其右键新建-“DWORD值（32位）”，重命名为“AllowInsecureGuestAuth”，同时将其值修改为“1”，新建一个注册表值（名为“ProhibitIPSec”，值为“1”）<br>“网络和共享中心”点击左上角的“更改高级共享设置”“来宾或公用”栏目，勾选“启用网络发现”和“启用文件和打印共享”项<br>运行“services.msc”“Server”服务设置为“自动”，并“启动”<br>重启</p>
<p>参考<a target="_blank" rel="noopener" href="https://www.jb51.net/os/win10/438373.html">win10局域网无法访问怎么办? win10网上邻居不能访问其他电脑的解决办法_windows10_Windows系列_操作系统_脚本之家</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/IT/">IT</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/IT/">IT</a><a href="/tags/树莓派4b/">树莓派4b</a><a href="/tags/samba/">samba</a><a href="/tags/局域网共享文件夹/">局域网共享文件夹</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2021/01/02/搭建私有云笔记-技术篇7vsftp/"><span>搭建私有云笔记-技术篇7vsftp</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2021/01/02/搭建私有云笔记-技术篇7vsftp/" rel="bookmark">
        <time class="entry-date published" datetime="2021-01-02T03:42:32.000Z">
          2021-01-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><strong>关键词：<font color="#BF360C">IT、树莓派4b、vsftpd</font></strong></p>
<h2 id="vsftpd"><a href="#vsftpd" class="headerlink" title="vsftpd"></a>vsftpd</h2><p>安装环境：<br>硬件，树莓派4b<br>操作系统，Raspbian GNU/Linux 10 (buster)</p>
<p>优点：vsftp是安全性很高的ftp服务软件，是linux系统常用配置软件。现有软件，可以做到跨平台数据传输和修改。<br>缺点：配置复杂。</p>
<p>需求：安全、可以外网访问的多人，有共享文件夹和个人文件夹的ftp，查阅vsftp配置后，选择ssl加密虚拟账户的vsftp配置<br>多用户共享文件夹配置参见树莓派硬盘挂载。</p>
<hr>
<h4 id="vsftp基本命令"><a href="#vsftp基本命令" class="headerlink" title="vsftp基本命令"></a>vsftp基本命令</h4><p>启动vsftp:<br><code>sudo service vsftpd start</code><br>也可以用：<br><code>sudo /etc/init.d/vsftpd start</code><br>或<br><code>sudo systemctl start vsftpd</code></p>
<p>重启vsftp:<br><code>sudo service vsftpd restart</code></p>
<p>关闭<br><code>sudo service vsftpd stop</code></p>
<p>查看状态<br><code>sudo service vsftpd status</code><br>或<br><code>sudo systemctl status vsftpd</code></p>
<hr>
<h4 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h4><h5 id="一般配置"><a href="#一般配置" class="headerlink" title="一般配置"></a>一般配置</h5><p>安装<br><code>sudo apt-get install vsftpd</code></p>
<p>启动<br><code>sudo service vsftpd start</code></p>
<p>修改配置参数<br><code>sudo nano /etc/vsftpd.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">listen&#x3D;YES</span><br><span class="line">listen_ipv6&#x3D;NO</span><br><span class="line">anonymous_enable&#x3D;NO</span><br><span class="line">local_enable&#x3D;YES</span><br><span class="line">write_enable&#x3D;NO</span><br><span class="line">#在个人账户配置中单独打开可写</span><br><span class="line">#local_umask&#x3D;022</span><br><span class="line">#在个人账户配置中单独配置写权限，022对应的文件权限是6-0、6-2、6-2，即644（读写、读、读）对应文件夹权限是7-0、7-2、7-2，即755（读写执行、读执行、读执行）执行这里才可看见下级目录</span><br><span class="line">#anon_upload_enable&#x3D;YES</span><br><span class="line">#匿名可上传</span><br><span class="line">#anon_mkdir_write_enable&#x3D;YES</span><br><span class="line">#匿名可建目录</span><br><span class="line">dirmessage_enable&#x3D;YES</span><br><span class="line">use_localtime&#x3D;YES</span><br><span class="line">xferlog_enable&#x3D;YES</span><br><span class="line">connect_from_port_20&#x3D;NO</span><br><span class="line">ftp_data_port&#x3D;xxx</span><br><span class="line">#关闭20端口，修改为你想要的端口</span><br><span class="line">#chown_uploads&#x3D;YES</span><br><span class="line">#chown_username&#x3D;whoever</span><br><span class="line">#xferlog_file&#x3D;&#x2F;var&#x2F;log&#x2F;vsftpd.log</span><br><span class="line">#xferlog_std_format&#x3D;YES</span><br><span class="line">#idle_session_timeout&#x3D;600</span><br><span class="line">#data_connection_timeout&#x3D;120</span><br><span class="line">#nopriv_user&#x3D;ftpsecure</span><br><span class="line">#async_abor_enable&#x3D;YES</span><br><span class="line">#ascii_upload_enable&#x3D;YES</span><br><span class="line">#ascii_download_enable&#x3D;YES</span><br><span class="line">#ftpd_banner&#x3D;Welcome to blah FTP service.</span><br><span class="line">#deny_email_enable&#x3D;YES</span><br><span class="line">#banned_email_file&#x3D;&#x2F;etc&#x2F;vsftpd.banned_emails</span><br><span class="line">chroot_local_user&#x3D;YES</span><br><span class="line">chroot_list_enable&#x3D;NO</span><br><span class="line">#限制账户不能离开家目录，对应个人配置文件</span><br><span class="line">#chroot_list_file&#x3D;&#x2F;etc&#x2F;vsftpd.chroot_list</span><br><span class="line">user_config_dir&#x3D;&#x2F;etc&#x2F;vsftpd&#x2F;user_conf</span><br><span class="line">#个人配置文件存放</span><br><span class="line">allow_writeable_chroot&#x3D;NO</span><br><span class="line">#根目录不可写</span><br><span class="line">#ls_recurse_enable&#x3D;YES</span><br><span class="line">secure_chroot_dir&#x3D;&#x2F;var&#x2F;run&#x2F;vsftpd&#x2F;empty</span><br><span class="line">pam_service_name&#x3D;vsftpd</span><br><span class="line">#utf8_filesystem&#x3D;YES</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h5 id="公网登录配置"><a href="#公网登录配置" class="headerlink" title="公网登录配置"></a>公网登录配置</h5><p><code>sudo nano /etc/vsftpd.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">#开启被动模式，使得公网能够登录</span><br><span class="line">pasv_enable&#x3D;YES</span><br><span class="line">#是否允许被动模式：是</span><br><span class="line">pasv_promiscuous&#x3D;YES</span><br><span class="line">#此选项激活将关闭PASV模式的安全检查。该检查确保数据连接和控制连接是来自同一个ip地址。</span><br><span class="line">#此选项唯一合理的用法是存在于由安全隧道方案构成的组织中。默认值为NO。</span><br><span class="line">#合理的用法是：在一些安全隧道配置环境下，或者更好地支持FXP时(才启用它)。</span><br><span class="line">pasv_min_port&#x3D;（你希望的被动传输端口号最小值）</span><br><span class="line">pasv_max_port&#x3D;（你希望的被动传输端口号最大值）</span><br><span class="line">listen_port&#x3D;（你希望的端口号）</span><br><span class="line">tcp_wrappers&#x3D;YES</span><br><span class="line">pasv_addr_resolve&#x3D;YES</span><br><span class="line">pasv_address&#x3D;xxx.xxx.xxx(你的网址)</span><br><span class="line">tcp_wrappers&#x3D;YES</span><br><span class="line">#安全机制</span><br><span class="line">#userlist_enable&#x3D;YES</span><br><span class="line">#userlist_deny&#x3D;YES</span><br><span class="line">#黑白名单</span><br><span class="line">#max_clients&#x3D;x</span><br><span class="line">#限制同一时间最多有多少client可以同时连vsftpd。</span><br><span class="line">#max_per_ip&#x3D;x</span><br><span class="line">#同一个ip同一时间可允许多少连接</span><br></pre></td></tr></table></figure>
<p><font color="#BF360C"><strong>公网登录需要配置对应的端口映射</strong></font></p>
<hr>
<h5 id="配置虚拟账户"><a href="#配置虚拟账户" class="headerlink" title="配置虚拟账户"></a>配置虚拟账户</h5><p>建立虚拟账户映射的本地账户vsftpd</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sudo useradd vsftpd -d &#x2F;home&#x2F;vsftpd -s &#x2F;bin&#x2F;false sudo </span><br><span class="line">sudo chown -R vsftpd:vsftpd &#x2F;home&#x2F;vsftpd</span><br></pre></td></tr></table></figure>
<p>创建虚拟用户数据库<br>在/etc/vsftpd目录下新建login.list文件，<br><code>sudo nano /etc/vsftpd/login.list</code></p>
<p>在里面输入虚拟用户名和密码，格式如下</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a</span><br><span class="line">123456</span><br><span class="line">b</span><br><span class="line">123456</span><br></pre></td></tr></table></figure>
<p>注意不要多空格和空行，其中奇数行为用户名，偶数行为密码。<br>最后一行需要回车（否则建立数据库文件时无法识别最后一行，导致报奇数行错误）。</p>
<p>安装DbUtil（apache旗下的一个JDBC封装的开源工具jar包，使用它调用数据库CRUD操作非常简便。）<br><code>sudo apt-get install db-util</code></p>
<p>安装完成后，使用db_load命令生成认证文件<br><code>sudo db_load -T -t hash -f /etc/vsftpd/login.list /etc/vsftpd/login.db</code></p>
<p>设置数据库文件的访问权限<br><code>sudo chmod 600 /etc/vsftpd/login.db</code></p>
<p>配置PAM文件</p>
<p>新建/etc/pam.d/vsftpd.vu，并编辑，<br><code>sudo touch /etc/pam.d/vsftpd.vu</code><br> <code>sudo nano /etc/pam.d/vsftpd.vu</code></p>
<p> 输入内容如下：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">auth sufficient &#x2F;usr&#x2F;lib&#x2F;arm-linux-gnueabihf&#x2F;security&#x2F;pam_userdb.so db&#x3D;&#x2F;etc&#x2F;vsftpd&#x2F;login</span><br><span class="line">account sufficient &#x2F;usr&#x2F;lib&#x2F;arm-linux-gnueabihf&#x2F;security&#x2F;pam_userdb.so db&#x3D;&#x2F;etc&#x2F;vsftpd&#x2F;login</span><br></pre></td></tr></table></figure>
<p><font color="#BF360C"><strong>注意查询pam_userdb.so所在的目录，可用</strong></font><br><code>find / -name pam_userdb.so</code><font color="#BF360C"><strong>查询</strong></font></p>
<p>修改配置参数<br><code>sudo nano /etc/vsftpd.conf</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">#虚拟用户配置：</span><br><span class="line">guest_enable&#x3D;YES</span><br><span class="line">guest_username&#x3D;vsftpd</span><br><span class="line">#虚拟账户映射到本地账户vsftpd</span><br></pre></td></tr></table></figure>
<p>配置虚拟用户参数<br>/etc/vsftpd/user_conf目录下配置</p>
<p>账户a<br><code>sudo nano /etc/vsftpd/user_conf/a</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">local_root&#x3D;&#x2F;home&#x2F;xxx</span><br><span class="line">#你想要的目录位置</span><br><span class="line">anon_umask&#x3D;007</span><br><span class="line">#虚拟账户读写权限</span><br><span class="line">anon_world_readable_only&#x3D;NO</span><br><span class="line">#虚拟账户用户浏览权限 </span><br><span class="line">anon_mkdir_write_enable&#x3D;YES</span><br><span class="line">#虚拟账户创建目录的同时可以在此目录中上传文件</span><br><span class="line">anon_upload_enable&#x3D;YES</span><br><span class="line">#虚拟账户用户上传权限 </span><br><span class="line">anon_other_write_enable&#x3D;YES</span><br><span class="line">#虚拟账户帐号可以有删除的权限</span><br><span class="line">write_enable&#x3D;YES</span><br><span class="line">#写权限</span><br></pre></td></tr></table></figure>
<p>账户b<br><code>略</code></p>
<hr>
<h5 id="ssl加密"><a href="#ssl加密" class="headerlink" title="ssl加密"></a>ssl加密</h5><p>查看vsftpd是否支持ssl<br><code>ldd `which vsftpd`|grep ssl</code></p>
<p>cd到希望保存密钥的目录下，使用openssl生成ssl秘钥文件（没有openssl需安装）</p>
<p>生成私钥<br><code>openssl req -newkey rsa:2048 -nodes -keyout vsftpd_private.key -x509 -days 365</code><br>用私钥生成公钥证书<br><code>openssl req -new -x509 -days 365 -key vsftpd_private.key -out vsftpd_cert.pem</code></p>
<p>设置ssl证书密钥信息，注意主机名称</p>
<p><code>cp vsftpd_private.key /etc/vsftpd/vsftpd_private.key</code><br><code>chmod 400 /etc/vsftpd/vsftpd_cert.pem</code><br><code>cp vsftpd_cert.pem /etc/xxx/vsftpd_cert.pem</code><br><code>chmod 400 /etc/xxx/vsftpd_cert.pem</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">ssl加密配置，放开参数注释即可用</span><br><span class="line">ssl_enable=YES</span><br><span class="line">allow_anon_ssl=YES</span><br><span class="line">force_local_data_ssl=NO</span><br><span class="line">force_local_logins_ssl=YES</span><br><span class="line">force_anon_logins_ssl=YES</span><br><span class="line">force_anon_data_ssl=YES</span><br><span class="line">require_ssl_reuse=NO</span><br><span class="line">#原来是FTP的require_ssl_reuse=YES导致的;</span><br><span class="line">#此时所有SSL数据连接都需要显示SSL会话重用;</span><br><span class="line">#证明他们知道与控制信道相同的主秘钥，解决方案，变成NO</span><br><span class="line">ssl_tlsv1=YES</span><br><span class="line">ssl_sslv2=NO</span><br><span class="line">ssl_sslv3=NO</span><br><span class="line">rsa_cert_file=<span class="regexp">/etc/</span>xxx/vsftpd_cert.pem</span><br><span class="line">rsa_private_key_file=<span class="regexp">/etc/</span>xxx/vsftpd_private.key</span><br><span class="line">#密钥放置的位置</span><br><span class="line">#ssl_ciphers=HIGH</span><br><span class="line">#FileZilla不支持默认密码(DES-CBC3-SHA)，加入后手机可ssl</span><br></pre></td></tr></table></figure>
<p>重启动<br><code>sudo service vsftpd restart</code></p>
<hr>
<h4 id="filezilla（ftp）客户端"><a href="#filezilla（ftp）客户端" class="headerlink" title="filezilla（ftp）客户端"></a>filezilla（ftp）客户端</h4><p>配置<br><img src="/2021/01/02/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%877vsftp/filezilla%E8%AE%BE%E7%BD%AE2020123101.png" alt="[filezilla设置2020123101.png]"><br><img src="/2021/01/02/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%877vsftp/filezilla%E8%AE%BE%E7%BD%AE2020123102.png" alt="[filezilla设置2020123102.png]"><br>如果不能登录则将传输设置改为主动模式</p>
<p>公网登录同理，主机填写网址，如果不能登录则将传输设置改为被动模式</p>
<p>###3、手机端配置<br>建议用ES文件浏览器配置类似<br>且如果开发了权限，FTP手机端可在线写入</p>
<hr>
<p><strong><font color="#BF360C">坑1</font>：配置文件中参数有空格或者错字。</strong><br><strong><font color="#BF360C">坑2</font>：虚拟账户对应的本地账户必须有家目录，但可以没有密码。</strong><br><strong><font color="#BF360C">坑3</font>：listen、listen_ipv6不可同时选YES。</strong><br><strong><font color="#BF360C">坑4</font>：注意根目录权限为不可写（更安全）且操作目录的属主和权限要与登录虚拟账户对应的本地账户对应。</strong><br><strong><font color="#BF360C">坑5</font>：关于加入了pasv_address=xxx.xxx.xxx(你的网址)参数，无法开机启动的问题，用/etc/rc.local添加开机启动命令，注意vsftpd需要一定的配置环境，所以立即开机启动无法运行，需要延时执行，在exit 0前添加。</strong></p>
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">sleep 50</span><br><span class="line">sudo /etc/init.d/vsftpd restart</span><br></pre></td></tr></table></figure>
<p><strong><font color="#BF360C">坑6</font>：配置文件的所有者须为root，权限为644<br>包括放在user_config_dir=/etc/vsftpd/xxxxxxx的虚拟账户配置文件<br>对应错误代码500OOPS: config file not owned by correct user, or not a file</strong></p>
<p><strong>坑7：设置ssl加密后，内网无法登录。解决方案，再启动一个vsftpd端口，复制配置文件<code>/etc/vsftpd.conf</code>重命名为<code>sudo nano /etc/vsftpd1.conf</code>，修改</strong></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">pasv_min_port=新的被动端口最小值</span><br><span class="line">pasv_max_port=新的被动端口最大值</span><br><span class="line">listen_port=新的监听端口</span><br><span class="line">pasv_addr_resolve=YES</span><br><span class="line">pasv_address=<span class="number">192.168</span><span class="number">.1</span><span class="number">.6</span></span><br></pre></td></tr></table></figure>
<p><code>sudo nano /etc/rc.local</code></p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">sudo /etc/init.d/vsftpd restart</span><br><span class="line">sudo /usr/sbin/vsftpd /etc/vsftpd1.conf &amp;</span><br><span class="line">exit <span class="number">0</span></span><br></pre></td></tr></table></figure>
<p><strong>重启<code>sudo reboot</code></strong></p>
<hr>
<p>附：<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/miclesvic/articles/10437213.html">vsftpd配置文件参数详解 - miclesvic - 博客园</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/IT/">IT</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/IT/">IT</a><a href="/tags/树莓派/">树莓派</a><a href="/tags/vsftpd/">vsftpd</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2021/01/02/搭建私有云笔记-技术篇6树莓派硬盘挂载/"><span>搭建私有云笔记-技术篇6树莓派硬盘挂载</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2021/01/02/搭建私有云笔记-技术篇6树莓派硬盘挂载/" rel="bookmark">
        <time class="entry-date published" datetime="2021-01-02T02:49:32.000Z">
          2021-01-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><strong>关键词：<font color="#BF360C">IT、树莓派、挂载</font></strong></p>
<h2 id="树莓派硬盘挂载"><a href="#树莓派硬盘挂载" class="headerlink" title="树莓派硬盘挂载"></a>树莓派硬盘挂载</h2><p>树莓派使用32G闪存卡启动，容量不足，打造私有云，须挂载硬盘。</p>
<p>安装环境：<br>硬件，树莓派4b<br>操作系统，Raspbian GNU/Linux 10 (buster)</p>
<p>查看硬盘<br><code>sudo fdisk -l</code></p>
<p>其中/dev/sda为用<code>sudo fdisk -l</code>命令查询的硬盘（u盘）设备名称</p>
<p>查看挂载<br><code>sudo df -h</code></p>
<p>parted分区<br><code>parted /dev/sda</code></p>
<p>分区选择</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">root@yishijie:~# parted GNU Parted 3.2 Using &#x2F;dev&#x2F;sda Welcome to GNU Parted! Type &#39;help&#39; to view a list of commands. (parted) mklabel gpt  </span><br><span class="line">Warning: The existing disk label on &#x2F;dev&#x2F;sda will be destroyed and all data on this disk will be lost. Do you want to continue? Yes&#x2F;No? y  </span><br><span class="line">(parted) mkpart  </span><br><span class="line">Partition name? \[\]? yishijie  </span><br><span class="line">File system type? \[ext2\]? ext4</span><br><span class="line"></span><br><span class="line">(parted) mkpart primary 0.00T 100%  </span><br><span class="line">Start? 0  </span><br><span class="line">End? 100%  </span><br><span class="line">Warning: The resulting partition is not properly aligned for best performance. Ignore&#x2F;Cancel? I (parted) print</span><br></pre></td></tr></table></figure>
<p>参考文献：<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/machangwei-8/p/10353690.html">parted命令详解 - 马昌伟 - 博客园</a></p>
<p><font color="#BF360C"><strong>使用 parted 工具对对硬盘进行分区操作后，我们一定要进行格式化分区才能被使用！</strong>  </font></p>
<p>使用 mkfs 工具可以方便地对分区进行格式化。<br><code>sudo mkfs -t ext4 /dev/sda</code></p>
<hr>
<h4 id="挂载方案1"><a href="#挂载方案1" class="headerlink" title="挂载方案1"></a>挂载方案1</h4><p>查询UUID命令<br><code>sudo blkid /dev/sda</code></p>
<p>开机永久挂载，注意uuid会变<br><code>sudo nano /etc/fstab</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">UUID&#x3D;56c8f78c-0e59-4b78-b5f8-d71f36fc558c &#x2F;yi ext4 defaults,nofail 0 0</span><br><span class="line">&#x2F;yi &#x2F;home&#x2F;yxx&#x2F;yi none rw,bind 0 0</span><br><span class="line">&#x2F;yi&#x2F;hexo &#x2F;home&#x2F;yxx&#x2F;hexo none rw,bind 0 0</span><br><span class="line">&#x2F;yi&#x2F;gx&#x2F; &#x2F;yi&#x2F;yxx&#x2F;共享 none rw,bind 0 0</span><br><span class="line">&#x2F;yi&#x2F;gx&#x2F; &#x2F;yi&#x2F;dxz&#x2F;共享 none rw,bind 0 0</span><br><span class="line">&#x2F;yi&#x2F;gx&#x2F; &#x2F;yi&#x2F;yxx&#x2F;共享 none rw,bind 0 0</span><br><span class="line">&#x2F;yi&#x2F;gx&#x2F; &#x2F;yi&#x2F;dxx&#x2F;共享 none rw,bind 0 0</span><br><span class="line">&#x2F;yi&#x2F;gx&#x2F; &#x2F;yi&#x2F;kxx&#x2F;共享 none rw,bind 0 0</span><br><span class="line">&#x2F;yi&#x2F;gx&#x2F; &#x2F;yi&#x2F;mxx&#x2F;共享 none rw,bind 0 0</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>坑1，注<code>nofail</code>启动时若设备不存在直接忽略它而不报错。否则不能启动。</strong></p>
<p>设置每个个人文件夹一个共享文件</p>
<hr>
<h4 id="挂载方案2"><a href="#挂载方案2" class="headerlink" title="挂载方案2"></a>挂载方案2</h4><p>临时挂载（每次关机后挂载会失效）例：<br><code>sudo mount -t ext4 /dev/sda /mnt/yishijie</code></p>
<p>开机挂载<br><code>sudo nano /etc/rc.local</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">sudo mount -t ext4 &#x2F;dev&#x2F;sda &#x2F;yi</span><br><span class="line">#sudo mount &#x2F;dev&#x2F;sdb &#x2F;hexo</span><br><span class="line">sudo mount --bind &#x2F;yi&#x2F;ftp&#x2F;gx&#x2F; &#x2F;yi&#x2F;ftp&#x2F;yjj&#x2F;共享</span><br><span class="line">sudo mount --bind &#x2F;yi&#x2F;ftp&#x2F;gx&#x2F; &#x2F;yi&#x2F;ftp&#x2F;dy&#x2F;共享</span><br><span class="line">sudo mount --bind &#x2F;yi&#x2F;ftp&#x2F;gx&#x2F; &#x2F;yi&#x2F;ftp&#x2F;kgh&#x2F;共享</span><br><span class="line">sudo mount --bind &#x2F;yi&#x2F;ftp&#x2F;gx&#x2F; &#x2F;yi&#x2F;ftp&#x2F;mft&#x2F;共享</span><br><span class="line">sudo mount --bind &#x2F;yi&#x2F;ftp&#x2F;gx&#x2F; &#x2F;yi&#x2F;ftp&#x2F;dxz&#x2F;共享</span><br><span class="line">sudo mount --bind &#x2F;yi&#x2F;ftp&#x2F;gx&#x2F; &#x2F;yi&#x2F;ftp&#x2F;dsh&#x2F;共享</span><br><span class="line">#sudo mount --bind &#x2F;yi&#x2F;hexo&#x2F; &#x2F;home&#x2F;yihe&#x2F;hexo</span><br></pre></td></tr></table></figure>

<p>注意：<br>1.硬盘uuid的变化，<br>2.挂载文件夹类型用none，在hexo安装后挂载</p>
<p>参考文献：<br><a target="_blank" rel="noopener" href="https://blog.csdn.net/daydayup654/article/details/78788310">Linux中挂载详解以及mount命令用法_daydayup654的博客</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/IT/">IT</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/IT/">IT</a><a href="/tags/树莓派/">树莓派</a><a href="/tags/linux/">linux</a><a href="/tags/硬盘挂载/">硬盘挂载</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2021/01/02/搭建私有云笔记-技术篇5pptpd/"><span>搭建私有云笔记-技术篇5pptpd</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2021/01/02/搭建私有云笔记-技术篇5pptpd/" rel="bookmark">
        <time class="entry-date published" datetime="2021-01-02T02:44:02.000Z">
          2021-01-02
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><strong>关键词：<font color="#BF360C">IT、树莓派、pptpd</font></strong></p>
<h2 id="PPTPD"><a href="#PPTPD" class="headerlink" title="PPTPD"></a>PPTPD</h2><p>安装环境：<br>硬件，树莓派4b<br>操作系统，Raspbian GNU/Linux 10 (buster)</p>
<p>树莓派也可以安装pptpd来配置vpn（弈何用华为AR L2tp-Ipsec VPN始终无法实现手机vpn连接）</p>
<p>安装pptpd软件<br><code>sudo apt-get install pptpd</code></p>
<p>配置pptpd 虚拟网关和ip段，注意要和局域网ip段不同<br><code>sudo nano /etc/pptpd.conf</code> </p>
<p>设置ip段，比如：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">localip 192.168.2.1</span><br><span class="line">#虚拟网关</span><br><span class="line">remoteip 192.168.2.20-100,192.168.2.245</span><br><span class="line">#设置ip分配网段</span><br></pre></td></tr></table></figure>
<p>配置dns<br><code>sudo nano /etc/ppp/pptpd-options</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">ms-dns 192.168.1.1</span><br><span class="line">#路由器网关</span><br><span class="line">ms-dns 61.139.2.69</span><br><span class="line">#四川电信DNS</span><br></pre></td></tr></table></figure>
<p>设置账号密码<br><code>sudo nano /etc/ppp/chap-secrets</code></p>
<p>格式：账号(tab键或空格)    *    密码    *<br>例如：<br><code>zhangsan    *       9527    *</code></p>
<p>开启ip转发（主机一般只发送和接受数据报，这是因为主机上/proc/sys/net/ipv4/ip_forward内核参数默认被设置为0。可以修改该值来使能主机的数据报转发功能）<br><code>sudo nano /etc/sysctl.conf</code><br><code>net.ipv4.ip_forward = 1</code></p>
<p>并执行<br><code>sudo sysctl -p</code></p>
<p>重启<br><code>sudo service pptpd restart</code></p>
<p><font color="#BF360C"><strong>对有防火墙的要配置防火墙参数。</strong></font></p>
<hr>
<h2 id="pptpd手机端Vpn客户端配置"><a href="#pptpd手机端Vpn客户端配置" class="headerlink" title="pptpd手机端Vpn客户端配置"></a>pptpd手机端Vpn客户端配置</h2><p><img src="/2021/01/02/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%875pptpd/%E6%89%8B%E6%9C%BApptpdVPN2020122902.png" alt="[手机pptpdVPN2020122902.png]"></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/IT/">IT</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/IT/">IT</a><a href="/tags/树莓派/">树莓派</a><a href="/tags/linux/">linux</a><a href="/tags/pptpd/">pptpd</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/12/25/搭建私有云笔记-技术篇4安装树莓派/"><span>搭建私有云笔记-技术篇4安装树莓派</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/12/25/搭建私有云笔记-技术篇4安装树莓派/" rel="bookmark">
        <time class="entry-date published" datetime="2020-12-25T08:03:33.000Z">
          2020-12-25
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><strong>关键词：<font color="#BF360C">IT、树莓派</font></strong></p>
<p>树莓派：Raspberry Pi(中文名为“树莓派”,简写为RPi，(或者RasPi / RPI)是为学习计算机编程教育而设计)，只有信用卡大小的微型电脑，低能耗，可以做家庭服务器。其操作系统基于Linux。弈何买的树莓派4b，8g内存，主要为以后批量处理一些数据留一点储备算力。如果做NAS（私有云），4G就够用了。</p>
<hr>
<h2 id="安装树莓派"><a href="#安装树莓派" class="headerlink" title="安装树莓派"></a>安装树莓派</h2><p>1、修改TF卡名称</p>
<p>2、用SDFormatter格式化闪存</p>
<p>3、用Win32DiskImager或Raspberry Pi Imager导入镜像</p>
<p>（镜像可在官网下载：</p>
<ul>
<li>Raspberry Pi OS with desktop and recommended software</li>
<li>Release date: December 2nd 2020</li>
<li>Kernel version: 5.4）</li>
</ul>
<p>4、在闪存根目录处创建无后缀名的ssh文本文档，作为树莓派ssh入口</p>
<p>3、用putty进行远程控制：<code>pi@192.168.1.x</code>（sn:raspberry,ip是树莓派的内网ip，可通过路由器或ipscan等方案查询获取）</p>
<p>4、修改源<br>树莓派的源在外网，很慢，所以一般更换国内源更好，一般用大学或阿里等的源。</p>
<p>不清楚自己版本的，可以先查看自己系统的版本<br>树莓派版本查看命令：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">getconf LONG_BIT   # 查看系统位数</span><br><span class="line">lsb_release -a   # 查看操作系统版本</span><br></pre></td></tr></table></figure>
<p>要更换版本对应的源，否则软件更新容易出错。</p>
<p><code>sudo nano /etc/apt/sources.list</code></p>
<p>弈何用的是Raspbian GNU/Linux 10 (buster)，更换清华源：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">deb http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;raspbian&#x2F;raspbian&#x2F; buster main non-free contrib rpi</span><br><span class="line">deb-src http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;raspbian&#x2F;raspbian&#x2F; buster main non-free contrib rpi</span><br></pre></td></tr></table></figure>
<p><code>sudo nano /etc/apt/sources.list.d/raspi.list</code></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">deb http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;raspberrypi&#x2F; buster main ui</span><br><span class="line">deb-src http:&#x2F;&#x2F;mirrors.tuna.tsinghua.edu.cn&#x2F;raspberrypi&#x2F; buster main ui</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>5、获取root权限</p>
<p><code>sudo passwd root</code><br>设置密码</p>
<p>6、软件升级（用su命令切换到root权限，可以不输入sudo，而且apt-get upgrade需进入root权限才能更新，否则权限不足）</p>
<p><code>sudo apt-get update &amp;&amp; apt-get upgrade</code></p>
<p>7、远程连接windows，安装xrdp远程桌面软件</p>
<p><code>sudo apt-get install xrdp</code></p>
<p>8、安装火狐（个人偏好）</p>
<p><code>sudo apt-get install firefox-esr -y</code></p>
<p>9、删除chromium（个人偏好）</p>
<p><code>sudo apt-get remove chromium-browser</code></p>
<p><code>sudo apt-get remove chromium-codecs-ffmpeg-extra</code></p>
<p>10、修改树莓派配置</p>
<p><code>sudo raspi-config</code></p>
<p>配置说明：</p>
<p>修改主机名称<br>system options-hostname-改为自己喜欢的名称</p>
<p>增加中文字库<br>localisation options-locale<br>添加：zh_ GB2312 GBk UTF-8</p>
<p>扩展闪卡容量<br>advances options-expand</p>
<p>11、进一步修改树莓派主机名和pi用户名<br>参见<a target="_blank" rel="noopener" href="https://blog.csdn.net/qq_34347375/article/details/103484334?utm_medium=distribute.pc_relevant_download.none-task-blog-baidujs-1.nonecase&depth_1-utm_source=distribute.pc_relevant_download.none-task-blog-baidujs-1.nonecase">修改树莓派pi4的计算机名以及用户名_码上看世界-CSDN博客</a><br>使用root权限<br><code>su</code><br><code>nano /etc/shadow</code><br><code>nano /etc/passwd</code><br><code>mv /home/pi /home/&lt;username&gt;</code><br><code>nano /etc/group</code><br>修改上述三个文件，文件中的所有pi替换成<username><br><code>reboot</code><br>再次远程登录时要使用更改后的用户名登录<br>这样修改用户名风险较大，一定确保所有的旧用户名都被替换，并且旧的用户目录名也相应被修改。</username></p>
<p>11、设置超级账号 root ALL=(ALL:ALL) ALL</p>
<p><code>sudo visudo</code></p>
<p>可以sudoers添加下面四行中任意一条</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">qie ALL&#x3D;(ALL) ALL</span><br><span class="line">#允许用户youuser执行sudo命令(需要输入密码)。</span><br><span class="line">%qie ALL&#x3D;(ALL) ALL</span><br><span class="line">#允许用户组youuser里面的用户执行sudo命令(需要输入密码)</span><br><span class="line">qie ALL&#x3D;(ALL) NOPASSWD: ALL</span><br><span class="line">#允许用户youuser执行sudo命令,并且在执行的时候不输入密码</span><br><span class="line">%qie ALL&#x3D;(ALL) NOPASSWD: ALL</span><br><span class="line">#允许用户组youuser里面的用户执行sudo命令,并且在执行的时候不输入密码</span><br></pre></td></tr></table></figure>
<p>12、添加谷歌拼音</p>
<p><code>sudo apt-get install -y fcitx-googlepinyin</code></p>
<p>13、重启</p>
<p><code>sudo reboot</code></p>
<hr>
<p><strong><font color="#BF360C">坑1</font>：远程登陆时数字键盘经常会切换到不能使用（与Num lock指示灯亮否并不完全匹配）导致在密码设置的时候容易出现错误，导致密码错误。</strong></p>
<p><strong><font color="#BF360C">坑2</font>：家目录内容不能随便删除，否则导致远程登陆无法登陆，需重建家目录：<br>mkdir /home/用户名<br>并将刚创建的目录修改属主和属组<br>chown 属主：属组 -R /home/用户名<br>然后将/etc/skel/.bash_的文件copy到目录下面。</strong></p>
<p><strong><font color="#BF360C">坑3</font>：账号和权限。</strong></p>
<hr>
<p>参考文献：<br><a target="_blank" rel="noopener" href="https://raspberrypi.club/350.html">树莓派如何安装中文输入法 - 树莓派俱乐部</a></p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/IT/">IT</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/IT/">IT</a><a href="/tags/树莓派/">树莓派</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/12/25/搭建私有云笔记-技术篇3VPN/"><span>搭建私有云笔记-技术篇3VPN</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/12/25/搭建私有云笔记-技术篇3VPN/" rel="bookmark">
        <time class="entry-date published" datetime="2020-12-25T07:10:12.000Z">
          2020-12-25
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><strong>关键词：<font color="#BF360C">IT、VPN、华为AR路由器、L2tp VPN、Ipsec VPN</font></strong></p>
<hr>
<h2 id="VPN"><a href="#VPN" class="headerlink" title="VPN"></a>VPN</h2><p>VPN是通过加密通讯获得的虚拟专用网络，也称隧道技术，可以帮助我们在内网穿透后比较安全的连入服务器方的（局域）网络。</p>
<p>有很多软硬件搭配都可以实现VPN。</p>
<p>弈何采用了华为AR路由器实现了L2tp和IPsec VPN和树莓派4b实现了pptpd VPN两种方式，树莓派也可以采用openVPN，使用证书的方式提高安全性。</p>
<hr>
<h4 id="华为AR路由器L2tp和IPsec-VPN服务器配置方案："><a href="#华为AR路由器L2tp和IPsec-VPN服务器配置方案：" class="headerlink" title="华为AR路由器L2tp和IPsec VPN服务器配置方案："></a>华为AR路由器L2tp和IPsec VPN服务器配置方案：</h4><h5 id="1、L2tp-VPN服务器（华为路由器）"><a href="#1、L2tp-VPN服务器（华为路由器）" class="headerlink" title="1、L2tp VPN服务器（华为路由器）"></a>1、L2tp VPN服务器（华为路由器）</h5><p><img src="/2020/12/25/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%873VPN/%E5%8D%8E%E4%B8%BA%E8%B7%AF%E7%94%B1%E5%99%A8L2TP%E6%9C%8D%E5%8A%A1%E5%99%A8%E8%AE%BE%E7%BD%AE2020122501.png" alt="[华为路由器L2TP服务器设置2020122501.png]"></p>
<p>注意，<font color="#BF360C"><strong>vpn网关ip不要和原网关（路由器）ip相同</strong></font>。而且服务器配置的网段不要与服务器原局域网网段相同。</p>
<p>设置了L2tp VPN后还要开通相应的账号才能够连入<br><img src="/2020/12/25/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%873VPN/%E5%8D%8E%E4%B8%BA%E8%B7%AF%E7%94%B1%E5%99%A8VPN%E8%B4%A6%E5%8F%B7%E8%AE%BE%E7%BD%AE2020122501.png" alt="[华为路由器VPN账号设置2020122501.png]"></p>
<hr>
<h5 id="2、VPN客户端"><a href="#2、VPN客户端" class="headerlink" title="2、VPN客户端"></a>2、VPN客户端</h5><p>安装环境：<br>硬件，电脑<br>操作系统，windows7，window10</p>
<p>windows自带VPN客户端工具，可以直接利用之：</p>
<p><img src="/2020/12/25/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%873VPN/VPN%E5%AE%A2%E6%88%B7%E7%AB%AF2020122501.png" alt="[VPN客户端2020122501.png]"><br><img src="/2020/12/25/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%873VPN/VPN%E5%AE%A2%E6%88%B7%E7%AB%AF2020122502.png" alt="[VPN客户端2020122502.png]"><br><img src="/2020/12/25/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%873VPN/VPN%E5%AE%A2%E6%88%B7%E7%AB%AF2020122503.png" alt="[VPN客户端2020122503.png]"><br><img src="/2020/12/25/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%873VPN/VPN%E5%AE%A2%E6%88%B7%E7%AB%AF2020122504.png" alt="[VPN客户端2020122504.png]"><br><img src="/2020/12/25/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%873VPN/VPN%E5%AE%A2%E6%88%B7%E7%AB%AF2020122505.png" alt="[VPN客户端2020122505.png]"><br><img src="/2020/12/25/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%873VPN/VPN%E5%AE%A2%E6%88%B7%E7%AB%AF2020122506.png" alt="[VPN客户端2020122506.png]"><br><img src="/2020/12/25/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%873VPN/VPN%E5%AE%A2%E6%88%B7%E7%AB%AF2020122507.png" alt="[VPN客户端2020122507.png]"><br>注意安全设置<br><img src="/2020/12/25/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%873VPN/VPN%E5%AE%A2%E6%88%B7%E7%AB%AF2020122508.png" alt="[VPN客户端2020122508.png.png]"></p>
<p><font color="#BF360C"><strong>配置客户端坑：windows7 VPN 错误800，或windows10出现，L2TP因为安全层在初始化与远程计算机的协商时遇到了一个处理错误</strong></font></p>
<p>常见原因：<br>由于配置异常造成的无法连接，虽然用户没有做过任何的配置修改，但由于系统内部的故障会导致配置（注册表信息）出现异常，这是Windows系统中常见的问题</p>
<p>解决办法：修改Windows注册表，不使用数字证书认证功能。 </p>
<p>单击“开始 &gt; 运行”，输入regedit打开注册表，找到路径在左侧注册表项目中逐级找到：HKEY_LOCAL_MACHINE/System/CurrentControlSet/Services/Rasman/Parameters，单击Parameters参数，接着在右边窗口空白处单击鼠标右键，选择［新建/双字节值］并新建一个注册表值（名称为ProhibitIPSec，值为1），AllowL2TPWeakCrypto 注册表项，选择DWORD类型并将其设置为 1 的值，重启。</p>
<hr>
<h5 id="3、IPsecVPN（华为路由器）"><a href="#3、IPsecVPN（华为路由器）" class="headerlink" title="3、IPsecVPN（华为路由器）"></a>3、IPsecVPN（华为路由器）</h5><p>ACL（访问控制列表）配置<br><img src="/2020/12/25/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%873VPN/%E5%8D%8E%E4%B8%BA%E8%B7%AF%E7%94%B1%E5%99%A8ACL2020122801.png" alt="[华为路由器ACL2020122801.png]"></p>
<p>IPsec VPN配置<br><img src="/2020/12/25/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%873VPN/%E5%8D%8E%E4%B8%BA%E8%B7%AF%E7%94%B1%E5%99%A8IPsecVPN2020122901.png" alt="[华为路由器IPsecVPN2020122901.png]"></p>
<hr>
<h5 id="4、IPsecVPN客户端配置"><a href="#4、IPsecVPN客户端配置" class="headerlink" title="4、IPsecVPN客户端配置"></a>4、IPsecVPN客户端配置</h5><p>注意在安全对话框填写时，修改<br>![[VPN客户端2020122509.png.png]]<br>编写设置的预共享密钥。</p>
<p>其余客户端配置同L2tpVPN</p>
<hr>
<p>其他还有：树莓派安装pptpd、openVPN服务器等实现VPN技术的方案详见后文。</p>

      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/IT/">IT</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/IT/">IT</a><a href="/tags/VPN/">VPN</a><a href="/tags/华为AR路由器/">华为AR路由器</a><a href="/tags/L2tp-VPN/">L2tp VPN</a><a href="/tags/Ipsec-VPN/">Ipsec VPN</a>
    </span>
    

    </div>

    
  </div>
</article>



  <article>

  
    
    <h3 class="article-title"><a href="/2020/12/25/搭建私有云笔记-技术篇2远程控制和关机/"><span>搭建私有云笔记-技术篇2远程控制和关机</span></a></h3>
    
  

  <div class="article-top-meta">
    <span class="posted-on">
      <a href="/2020/12/25/搭建私有云笔记-技术篇2远程控制和关机/" rel="bookmark">
        <time class="entry-date published" datetime="2020-12-25T02:25:59.000Z">
          2020-12-25
        </time>
      </a>
    </span>
  </div>


  

  <div class="article-content">
    <div class="entry">
      
        <p><strong>关键词：<font color="#BF360C">IT、远程控制、mstsc、xrdp、远程关机</font></strong></p>
<hr>
<h2 id="远程控制"><a href="#远程控制" class="headerlink" title="远程控制"></a>远程控制</h2><h4 id="windows间的远程控制"><a href="#windows间的远程控制" class="headerlink" title="windows间的远程控制"></a>windows间的远程控制</h4><p>包括windows自带的远程桌面mstsc，速度快，和第三方远程桌面软件：如qq远程控制等</p>
<h5 id="方案1：QQ远程"><a href="#方案1：QQ远程" class="headerlink" title="方案1：QQ远程"></a>方案1：QQ远程</h5><p><font color="#BF360C"><strong>优点：操作简单，无需任何网络参数配置。</strong></font><br>缺点：有延迟感。</p>
<p>实现方法：使用QQ的请求控制对方电脑，并在需要控制的电脑端设置QQ开机启动，并在QQ的请求控制电脑的设置中配置自动接受连接请求。<br>这样在控制端输入密码即可远程控制目标电脑的桌面。</p>
<h5 id="方案2：mstsc"><a href="#方案2：mstsc" class="headerlink" title="方案2：mstsc"></a>方案2：mstsc</h5><p><font color="#BF360C"><strong>优点：非常方便，且速度快，无延迟。</strong></font><br>缺点：需要做端口映射，有一定风险。</p>
<p>实现方法：<br>1、目标段设置<br>需先开通目标机远程设置，<br>目标机windows远程桌面设置：  </p>
<p><img src="/2020/12/25/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%872%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%92%8C%E5%85%B3%E6%9C%BA/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A22020122501.png" alt="[远程桌面2020122501.png]"></p>
<p><img src="/2020/12/25/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%872%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%92%8C%E5%85%B3%E6%9C%BA/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A22020122501.png" alt="[远程桌面2020122502.png]"></p>
<p>然后做端口映射（目标设备远程桌面端口号一般是3389，在做映射时路由器对外的端口号可以换一个任意端口号增加安全性。）</p>
<p>2、在控制端，输入IP+端口号，或者输入域名+端口号，即可连接。</p>
<p>windows连接设置：  </p>
<p><img src="/2020/12/25/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%872%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%92%8C%E5%85%B3%E6%9C%BA/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A22020122503.png" alt="[远程桌面2020122503.png]"></p>
<p>或者 </p>
<p><img src="/2020/12/25/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%872%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%92%8C%E5%85%B3%E6%9C%BA/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A22020122501.png" alt="[远程桌面2020122504.png]"></p>
<p><font color="#BF360C"><strong>运行（Ctrl+r）：mstsc</strong></font><br>填入ip（域名）:相应端口，如3389</p>
<p><img src="/2020/12/25/%E6%90%AD%E5%BB%BA%E7%A7%81%E6%9C%89%E4%BA%91%E7%AC%94%E8%AE%B0-%E6%8A%80%E6%9C%AF%E7%AF%872%E8%BF%9C%E7%A8%8B%E6%8E%A7%E5%88%B6%E5%92%8C%E5%85%B3%E6%9C%BA/%E8%BF%9C%E7%A8%8B%E6%A1%8C%E9%9D%A22020122501.png" alt="[远程桌面2020122505.png]"></p>
<p>填入用户名和密码登陆。</p>
<h5 id="方案3：其他远程管理软件"><a href="#方案3：其他远程管理软件" class="headerlink" title="方案3：其他远程管理软件"></a>方案3：其他远程管理软件</h5><hr>
<h4 id="windows对树莓派的远程控制"><a href="#windows对树莓派的远程控制" class="headerlink" title="windows对树莓派的远程控制"></a>windows对树莓派的远程控制</h4><p>可以使用<font color="#BF360C"><strong>ssh</strong></font>用命令行远程控制<br>ssh登陆格式<br><code>ssh user@remote -p port</code><br>用户名@网址或ip:端口号<br>或用户名@网址或ip -p 端口号</p>
<p>也可以使用<font color="#BF360C"><strong>xrdp</strong></font>和其他远程桌面VNC 远程连接软件等</p>
<hr>
<h2 id="远程关机"><a href="#远程关机" class="headerlink" title="远程关机"></a>远程关机</h2><h5 id="方案1"><a href="#方案1" class="headerlink" title="方案1"></a>方案1</h5><p>在远程控制桌面<br>运行命令（Ctrl+r）<br><code>shutdown -t -s 0</code><br>-t关机<br>-s执行命令时间<br>0，秒，可以根据需要设计延时关机的时间<br>-r重启</p>
<h5 id="方案2，远程控制软件开关机"><a href="#方案2，远程控制软件开关机" class="headerlink" title="方案2，远程控制软件开关机"></a>方案2，远程控制软件开关机</h5><h5 id="方案3，连入VPN后，用局域网开关机控制软件进行关机。"><a href="#方案3，连入VPN后，用局域网开关机控制软件进行关机。" class="headerlink" title="方案3，连入VPN后，用局域网开关机控制软件进行关机。"></a>方案3，连入VPN后，用局域网开关机控制软件进行关机。</h5>
      
    </div>

  </div>

  <div class="article-footer">
    <div class="article-meta pull-left">

    
      

    <span class="post-categories">
      <i class="icon-categories"></i>
        <a href="/categories/IT/">IT</a>
    </span>
    

    
    

    <span class="post-tags">
      <i class="icon-tags"></i>
        <a href="/tags/IT/">IT</a><a href="/tags/远程控制/">远程控制</a><a href="/tags/mstsc/">mstsc</a><a href="/tags/xrdp/">xrdp</a><a href="/tags/远程关机/">远程关机</a>
    </span>
    

    </div>

    
  </div>
</article>




<nav class="pagination">
  
  
  <a href="/page/2/" class="pagination-next">下一页</a>
  
</nav>
    </main>

    <footer class="site-footer">
  <p class="site-info">
    Proudly powered by <a href="https://hexo.io/" target="_blank">Hexo</a> and
    Theme by <a href="https://github.com/CodeDaraW/Hacker" target="_blank">Hacker</a>
    </br>
    
    &copy; 2021 弈何
    
  </p>
</footer>
    
    
<script>
    var _hmt = _hmt || [];
    ( function () {
        var hm = document.createElement( "script" );
        hm.src = "https://hm.baidu.com/hm.js?dangeryond";
        var s = document.getElementsByTagName( "script" )[ 0 ];
        s.parentNode.insertBefore( hm, s );
    } )();
</script>

  </div>
</div>
</body>
</html>